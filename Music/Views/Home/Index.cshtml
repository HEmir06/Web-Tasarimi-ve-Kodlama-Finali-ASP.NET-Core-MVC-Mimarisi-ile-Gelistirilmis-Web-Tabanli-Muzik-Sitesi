@model List<Music.Models.Song>

@{
    ViewData["Title"] = "Ana Sayfa";
}

<div class="container mt-4">

    <div id="top-charts-section">
        @if (ViewData["CurrentFilter"] == null && Model.Any())
        {
            <div class="mb-5 animate__animated animate__fadeInDown">
                <h3 class="fw-bold mb-3 gradient-text d-inline-block">🔥 En Çok Dinlenenler</h3>

                <div class="d-flex overflow-auto gap-3 pb-3" style="scrollbar-width: thin;">
                    @foreach (var topSong in Model.OrderByDescending(s => s.PlayCount).Take(5))
                    {
                        <div class="card card-3d-effect shadow-sm border-0 flex-shrink-0" style="width: 200px; background-color: #fff;">
                            <div class="position-relative">

                                @if (!string.IsNullOrEmpty(topSong.ImageUrl))
                                {
                                    <img src="@topSong.ImageUrl" class="card-img-top" style="height: 150px; object-fit: cover; cursor: pointer;"
                                         onclick="playGlobalMusic('@topSong.AudioUrl',
                                                                              '@topSong.Title.Replace("'", "\\'")',
                                                                              '@topSong.Artist.Replace("'", "\\'")',
                                                                              '@topSong.ImageUrl',
                                                                              @topSong.Id)">
                                }
                                else
                                {
                                    <div class="bg-dark text-white d-flex align-items-center justify-content-center" style="height: 150px; cursor: pointer;"
                                         onclick="playGlobalMusic('@topSong.AudioUrl',
                                                                              '@topSong.Title.Replace("'", "\\'")',
                                                                              '@topSong.Artist.Replace("'", "\\'")',
                                                                              '@topSong.ImageUrl',
                                                                              @topSong.Id)">
                                        <i class="bi bi-music-note-beamed fs-1"></i>
                                    </div>
                                }

                                <span class="position-absolute top-0 end-0 badge bg-warning text-dark m-2 shadow-sm">
                                    🎧 @topSong.PlayCount
                                </span>

                                <div class="position-absolute top-50 start-50 translate-middle pointer-events-none">
                                    <i class="bi bi-play-circle-fill text-white opacity-75" style="font-size: 3rem; pointer-events: none;"></i>
                                </div>

                            </div>

                            <div class="card-body p-2 text-center">
                                <h6 class="card-title fw-bold text-truncate text-dark mb-0">@topSong.Title</h6>
                                <small class="text-muted">@topSong.Artist</small>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    <h3 class="fw-bold mb-4 gradient-text d-inline-block" id="all-songs-title">🎵 Tüm Müzikler</h3>

    <div class="row" id="songListContainer">
        <partial name="_SongListPartial" model="Model" />
    </div>

</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Arama kutusuna her harf girildiğinde çalışır
            $('.search-input').on('keyup', function () {

                var value = $(this).val(); // Yazılanı al

                // Kutu doluysa vitrini gizle, boşsa göster
                if (value.length > 0) {
                    $('#top-charts-section').slideUp();
                    $('#all-songs-title').text("🔍 Arama Sonuçları: " + value);
                } else {
                    $('#top-charts-section').slideDown();
                    $('#all-songs-title').text("🎵 Tüm Müzikler");
                }

                // Arka plana sessizce git, veriyi al ve getir (AJAX)
                $.ajax({
                    url: '/Home/LiveSearch',
                    type: 'GET',
                    data: { searchString: value },
                    success: function (result) {
                        $('#songListContainer').html(result); // Sonuçları ekrana bas
                    },
                    error: function (err) {
                        console.log("Hata:", err);
                    }
                });
            });

            // Enter tuşuna basınca sayfanın yenilenmesini engelle
            $('form').on('submit', function(e) {
                if($(this).find('.search-input').length > 0) {
                    e.preventDefault();
                }
            });
        });
    </script>
}
